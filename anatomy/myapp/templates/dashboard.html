{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediDash - Organ Health Dashboard</title>
    <link rel="stylesheet" href="{% static 'dashboard.css' %}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
    <div class="sidebar">
        <h2>Project Organ</h2>
        <ul>
            <li><a href="#dashboard">Dashboard</a></li>
            <li><a href="#heart">Heart</a></li>
            <li><a href="#lungs">Lungs</a></li>
            <li><a href="#brain">Brain</a></li>
            <li><a href="#liver">Liver</a></li>
            <li><a href="#kidneys">Kidneys</a></li>
            <li><a href="#about">About</a></li>
        </ul>
    </div>
    <div class="main-content">
        <div class="header">
            <h1>Project Organ Dashboard</h1>
        </div>
        <p>Welcome to [], your comprehensive organ health monitoring system. Select an organ to view detailed health metrics and analysis.</p>
        <div class="organ-grid">
            <div class="organ-card">
                <img src="{% static 'images/heart.jpg' %}" alt="Heart">
                <div class="organ-content">
                    <h3>Heart</h3>
                    <p>Monitor cardiovascular health and explore heart structures.</p>
                    <a href="#heart-details" class="organ-btn">View Model</a>
                </div>
            </div>
            <div class="organ-card">
                <img src="{% static 'images/lungs.jpg' %}" alt="Lungs">
                <div class="organ-content">
                    <h3>Lungs</h3>
                    <p>Track respiratory function and examine lung anatomy.</p>
                    <a href="#lungs-details" class="organ-btn">View Model</a>
                </div>
            </div>
            <div class="organ-card">
                <img src="{% static 'images/brain.webp' %}" alt="Brain">
                <div class="organ-content">
                    <h3>Brain</h3>
                    <p>Assess neurological activity and explore brain regions.</p>
                    <button id="viewBrainModelBtn" class="organ-btn">View Model</button>
                </div>
                <div id="brain-model-container"></div>
            </div>
            <div class="organ-card">
                <img src="{% static 'images/liver.jpg' %}" alt="Liver">
                <div class="organ-content">
                    <h3>Liver</h3>
                    <p>Evaluate hepatic performance and liver structure.</p>
                    <a href="#liver-details" class="organ-btn">View Model</a>
                </div>
            </div>
            <div class="organ-card">
                <img src="{% static 'images/kidneys.jpg' %}" alt="Kidneys">
                <div class="organ-content">
                    <h3>Kidneys</h3>
                    <p>Analyze renal function and kidney anatomy.</p>
                    <a href="#kidneys-details" class="organ-btn">View Model</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Brain Model -->
    <div id="brainModelModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Brain Model</h2>
            <div id="three-js-container" style="width: 100%; height: 400px;"></div>
        </div>
    </div>

    <script src="{% static 'three-viewer.js' %}"></script>
    <script>
        // Get the modal
        var modal = document.getElementById("brainModelModal");

        // Get the button that opens the modal
        var btn = document.getElementById("viewBrainModelBtn");

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];

        // When the user clicks the button, open the modal
        btn.onclick = function() {
            modal.style.display = "block";
            loadBrainModel();
        }

        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
            modal.style.display = "none";
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        function loadBrainModel() {
            const container = document.getElementById('three-js-container');
            container.innerHTML = ''; // Clear previous content

            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer();
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(renderer.domElement);

            const light = new THREE.DirectionalLight(0xffffff, 1);
            light.position.set(1, 1, 1).normalize();
            scene.add(light);

            const loader = new THREE.GLTFLoader();
            loader.load(
                '{% static "models/brain_model.glb" %}',
                function (gltf) {
                    scene.add(gltf.scene);
                    camera.position.z = 5;

                    const animate = function () {
                        requestAnimationFrame(animate);
                        gltf.scene.rotation.y += 0.01;
                        renderer.render(scene, camera);
                    };
                    animate();
                },
                undefined,
                function (error) {
                    console.error('An error occurred:', error);
                }
            );
        }
    </script>
</body>
</html>
